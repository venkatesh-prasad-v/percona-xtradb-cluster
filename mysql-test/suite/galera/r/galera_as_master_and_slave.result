#node-2 (galera-cluster-node acting as replica to an independent master)
START REPLICA USER='root';
Warnings:
Note	1759	Sending passwords in plain text without SSL/TLS is extremely insecure.
#node-4 (independent replica replicating from galera-node-2)
START REPLICA USER='root';
Warnings:
Note	1759	Sending passwords in plain text without SSL/TLS is extremely insecure.
#node-1 (independent master)
use test;
create table t (i int, c char(10), primary key pk(i)) engine=innodb;
insert into t values (1, 'aaaaaa'), (2, 'bbbbbb'), (3, 'cccccc'),
(4, 'dddddd'), (5, 'eeeeee');
select locate(':1-2', @@global.gtid_executed);
locate(':1-2', @@global.gtid_executed)
VALID_POS
select * from t;
i	c
1	aaaaaa
2	bbbbbb
3	cccccc
4	dddddd
5	eeeeee
#node-2 (galera-cluster-node acting as replica to an independent master)
select * from t;
i	c
1	aaaaaa
2	bbbbbb
3	cccccc
4	dddddd
5	eeeeee
#node-3 (galera-cluster-node-2 that act as master to independent replica)
select * from t;
i	c
1	aaaaaa
2	bbbbbb
3	cccccc
4	dddddd
5	eeeeee
#node-4 (independent replica replicating from galera-node-2)
select * from t;
i	c
1	aaaaaa
2	bbbbbb
3	cccccc
4	dddddd
5	eeeeee
select @@replica_parallel_workers;
@@replica_parallel_workers
4
set global replica_parallel_workers=2;
select @@replica_parallel_workers;
@@replica_parallel_workers
2
STOP REPLICA;
START REPLICA USER='root';
Warnings:
Note	1759	Sending passwords in plain text without SSL/TLS is extremely insecure.
#node-1 (independent master)
use test;
insert into t values (1000, 'aaaaaa');
insert into t values (2000, 'bbbbbb');
select locate(':1-4', @@global.gtid_executed);
locate(':1-4', @@global.gtid_executed)
VALID_POS
select * from t;
i	c
1	aaaaaa
2	bbbbbb
3	cccccc
4	dddddd
5	eeeeee
1000	aaaaaa
2000	bbbbbb
#node-2 (galera-cluster-node acting as replica to an independent master)
select * from t;
i	c
1	aaaaaa
2	bbbbbb
3	cccccc
4	dddddd
5	eeeeee
1000	aaaaaa
2000	bbbbbb
select left(@@global.gtid_executed, 36) = '<master_id>';;
left(@@global.gtid_executed, 36) = '<master_id>'
1
#node-3 (galera-cluster-node-2 that act as master to independent replica)
select * from t;
i	c
1	aaaaaa
2	bbbbbb
3	cccccc
4	dddddd
5	eeeeee
1000	aaaaaa
2000	bbbbbb
select left(@@global.gtid_executed, 36) = '<master_id>';;
left(@@global.gtid_executed, 36) = '<master_id>'
1
#node-4 (independent replica replicating from galera-node-2)
select * from t;
i	c
1	aaaaaa
2	bbbbbb
3	cccccc
4	dddddd
5	eeeeee
1000	aaaaaa
2000	bbbbbb
select left(@@global.gtid_executed, 36) = '<master_id>';;
left(@@global.gtid_executed, 36) = '<master_id>'
1
select @@replica_parallel_workers;
@@replica_parallel_workers
2
set global replica_parallel_workers=0;
Warnings:
Warning	1287	'0' is deprecated and will be removed in a future release. Please use 1 instead
select @@replica_parallel_workers;
@@replica_parallel_workers
0
STOP REPLICA;
START REPLICA USER='root';
Warnings:
Note	1759	Sending passwords in plain text without SSL/TLS is extremely insecure.
#node-2 (galera-cluster-node acting as replica to an independent master)
delete from t where i = 2;
update t set c = 'zzzzzz' where i = 4;
update t set c = 'pppppp', i = 50 where i = 5;
select * from t;
i	c
1	aaaaaa
3	cccccc
4	zzzzzz
50	pppppp
1000	aaaaaa
2000	bbbbbb
select locate(':1-3', @@global.gtid_executed);
locate(':1-3', @@global.gtid_executed)
VALID_POS
#node-4 (independent replica replicating from galera-node-2)
select * from t;
i	c
1	aaaaaa
3	cccccc
4	zzzzzz
50	pppppp
1000	aaaaaa
2000	bbbbbb
select locate(':1-3', @@global.gtid_executed);
locate(':1-3', @@global.gtid_executed)
VALID_POS
#node-1 (independent master)
delete from t where i = 2;
update t set c = 'zzzzzz' where i = 4;
update t set c = 'pppppp', i = 50 where i = 5;
select * from t;
i	c
1	aaaaaa
3	cccccc
4	zzzzzz
50	pppppp
1000	aaaaaa
2000	bbbbbb
select locate(':1-7', @@global.gtid_executed);
locate(':1-7', @@global.gtid_executed)
VALID_POS
#node-2 (galera-cluster-node acting as replica to an independent master)
select * from t;
i	c
1	aaaaaa
3	cccccc
4	zzzzzz
50	pppppp
1000	aaaaaa
2000	bbbbbb
select locate(':1-7', @@global.gtid_executed);
locate(':1-7', @@global.gtid_executed)
VALID_POS
#node-3 (galera-cluster-node-2 that act as master to independent replica)
select * from t;
i	c
1	aaaaaa
3	cccccc
4	zzzzzz
50	pppppp
1000	aaaaaa
2000	bbbbbb
select locate(':1-7', @@global.gtid_executed);
locate(':1-7', @@global.gtid_executed)
VALID_POS
#node-4 (independent replica replicating from galera-node-2)
select * from t;
i	c
1	aaaaaa
3	cccccc
4	zzzzzz
50	pppppp
1000	aaaaaa
2000	bbbbbb
select locate(':1-7', @@global.gtid_executed);
locate(':1-7', @@global.gtid_executed)
VALID_POS
#node-1 (independent master)
update t set c = 'kkkkk' where i = 1;
update t set c = 'k2', i = 100 where i = 1;
select * from t;
i	c
3	cccccc
4	zzzzzz
50	pppppp
100	k2
1000	aaaaaa
2000	bbbbbb
select locate(':1-9', @@global.gtid_executed);
locate(':1-9', @@global.gtid_executed)
VALID_POS
#node-3 (galera-cluster-node-2 that act as master to independent replica)
select * from t;
i	c
3	cccccc
4	zzzzzz
50	pppppp
100	k2
1000	aaaaaa
2000	bbbbbb
select locate(':1-9', @@global.gtid_executed);
locate(':1-9', @@global.gtid_executed)
VALID_POS
#node-1 (independent master)
DROP TABLE t;
#node-2 (galera-cluster-node acting as replica to an independent master)
STOP REPLICA;
RESET REPLICA ALL;
#node-1 (independent master)
set session wsrep_on=off;
RESET BINARY LOGS AND GTIDS;
set session wsrep_on=on;
#node-4 (independent replica replicating from galera-node-2)
STOP REPLICA;
RESET REPLICA ALL;
#node-3 (galera-cluster-node-2 that act as master to independent replica)
set session wsrep_on=off;
RESET BINARY LOGS AND GTIDS;
set session wsrep_on=on;
