# Use default setting for mysqld processes
!include include/default_mysqld.cnf
!include include/default_client.cnf

[mysqld]
log-bin=                    server-binary-log
relay-log=                  server-relay-log

enforce-gtid-consistency
gtid-mode=                  on

report-host=                127.0.0.1
report-user=                root

master-retry-count=         10
skip-replica-start

loose-group_replication_start_on_boot= OFF
loose-group_replication_single_primary_mode= FALSE
loose-group_replication_enforce_update_everywhere_checks= TRUE
loose-group_replication_recovery_get_public_key= TRUE
loose-group_replication_recovery_ssl_ca=$MYSQL_TEST_DIR/std_data/cacert.pem
loose-group_replication_recovery_ssl_cert=$MYSQL_TEST_DIR/std_data/client-cert.pem
loose-group_replication_recovery_ssl_key=$MYSQL_TEST_DIR/std_data/client-key.pem

# Directory where slaves find the dumps generated by "load data"
# on the server. The path need to have constant length otherwise
# test results will vary, thus a relative path is used.
replica-load-tmpdir=          ../../tmp

loose-innodb_write_io_threads= 1
loose-innodb_read_io_threads=  1

ssl-ca=@ENV.MYSQLTEST_VARDIR/std_data/cacert.pem
ssl-cert=@ENV.MYSQLTEST_VARDIR/std_data/server-cert.pem
ssl-key=@ENV.MYSQLTEST_VARDIR/std_data/server-key.pem

[mysqld.1]
binlog-format=row
#!run-suite-setup-sh

[mysqld.2]
binlog-format=row
#!run-suite-setup-sh

[mysqld.3]
binlog-format=row
#!run-suite-setup-sh

[mysqld.4]
binlog-format=row
#!run-suite-setup-sh

[mysqld.5]
binlog-format=row
#!run-suite-setup-sh

wsrep_provider=@ENV.WSREP_PROVIDER
wsrep_cluster_address='gcomm://'
wsrep_provider_options='repl.causal_read_timeout=PT90S;base_port=@mysqld.5.#galera_port;gmcast.peer_timeout=PT10S;evs.suspect_timeout=PT12S;evs.inactive_timeout=PT30S;evs.install_timeout=PT15S'

# enforce read-committed characteristics across the cluster
wsrep_causal_reads=ON
wsrep_sync_wait = 15

wsrep_node_address=127.0.0.1
wsrep_sst_receive_address=127.0.0.1:@mysqld.5.#sst_port
wsrep_node_incoming_address=127.0.0.1:@mysqld.5.port

# Required for Galera
innodb_autoinc_lock_mode=2

innodb_flush_log_at_trx_commit=2
wsrep_node_name=pxc_node

[sst]
encrypt=4

[ENV]
NODE_MYPORT_1= @mysqld.1.port
NODE_MYSOCK_1= @mysqld.1.socket
NODE_MYPORT_2= @mysqld.2.port
NODE_MYSOCK_2= @mysqld.2.socket
NODE_MYPORT_3= @mysqld.3.port
NODE_MYSOCK_3= @mysqld.3.socket
NODE_MYPORT_4= @mysqld.4.port
NODE_MYSOCK_4= @mysqld.4.socket
NODE_MYPORT_5= @mysqld.5.port
NODE_MYSOCK_5= @mysqld.5.socket

SERVER_MYPORT_1= @mysqld.1.port
SERVER_MYSOCK_1= @mysqld.1.socket
SERVER_MYPORT_2= @mysqld.2.port
SERVER_MYSOCK_2= @mysqld.2.socket
SERVER_MYPORT_3= @mysqld.3.port
SERVER_MYSOCK_3= @mysqld.3.socket
SERVER_MYPORT_4= @mysqld.4.port
SERVER_MYSOCK_4= @mysqld.4.socket
SERVER_MYPORT_5= @mysqld.5.port
SERVER_MYSOCK_5= @mysqld.5.socket

NODE_GALERAPORT_1= @mysqld.1.#galera_port
NODE_GALERAPORT_2= @mysqld.2.#galera_port
NODE_GALERAPORT_3= @mysqld.3.#galera_port
NODE_GALERAPORT_4= @mysqld.4.#galera_port
NODE_GALERAPORT_5= @mysqld.5.#galera_port

NODE_SSTPORT_1= @mysqld.1.#sst_port
NODE_SSTPORT_2= @mysqld.2.#sst_port
NODE_SSTPORT_3= @mysqld.3.#sst_port
NODE_SSTPORT_4= @mysqld.4.#sst_port
NODE_SSTPORT_5= @mysqld.5.#sst_port
